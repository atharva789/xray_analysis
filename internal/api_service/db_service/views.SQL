-- fetch DICOM_IDS by PatientID
-- fetch Dicom images by patient ID
-- fetch patient stats by patient IDs

CREATE OR REPLACE VIEW patient_files_n_stats_by_dicom AS 
SELECT 
  pd.PATIENT_ID, pd.DICOM_ID, d.DICOM_NAME, D.CREATED_AT, df.FILE_ID, f.FILETYPE, f.OBJECT_KEY, ps.AGASTON_SCORE
FROM PATIENTDICOMS pd
JOIN DICOMFILES df
  ON pd.DICOM_ID = df.DICOM_ID
JOIN DICOMS d 
  ON d.DICOM_ID = df.DICOM_ID
JOIN FILERECORDS f
  ON f.FILE_ID = df.FILE_ID
JOIN PATIENT_STATS ps
  ON ps.STAT_ID = d.STAT_ID;


CREATE OR REPLACE VIEW patient_accessions AS
SELECT 
  D.DICOM_ID, D.DICOM_NAME, D.CREATED_AT, PS.AGASTON_SCORE, FR.object_key
FROM PATIENTDICOMS PD 
JOIN DICOMS D
  ON PD.DICOM_ID = D.DICOM_ID
JOIN PATIENT_STATS PS
  ON PS.STAT_ID = D.STAT_ID
JOIN DICOMFILES DF 
  ON DF.DICOM_ID = D.DICOM_ID
JOIN FILERECORDS FR
  ON FR.FILE_ID = DF.FILE_ID;